<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="MarkBind 2.14.1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CS2030 AY19/20 Semester 2</title>
  <link rel="stylesheet" href="../../../../markbind/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../../markbind/css/bootstrap-vue.min.css">
  <link rel="stylesheet" href="../../../../markbind/fontawesome/css/all.min.css">
  <link rel="stylesheet" href="../../../../markbind/glyphicons/css/bootstrap-glyphicons.min.css">
  <link rel="stylesheet" href="../../../../markbind/css/octicons.css">
  <link rel="stylesheet" href="../../../../markbind/css/github.min.css">
  <link rel="stylesheet" href="../../../../markbind/css/markbind.css">
  <link rel="stylesheet" href="/1920-s2/plugins/markbind-plugin-anchors/markbind-plugin-anchors.css">
  <link rel="stylesheet" href="../../../../markbind/layouts/default/styles.css">
  <link rel="stylesheet" href="../../../../markbind/css/page-nav.css">
</head>

<body data-spy="scroll" data-target="#page-nav" data-offset="100">
  <div id="app">
    <header>
      <navbar type="dark" class="temp-navbar">
        <a slot="brand" href="/1920-s2/index.html" title="Home" class="navbar-brand">CS2030 AY19/20 Semester 2</a>
        <div class="nav-link temp-dropdown-placeholder">Peer Learning</div>
        <dropdown class="nav-link temp-dropdown"><template slot="_header">Peer Learning</template>
          <li><a href="/1920-s2/contents/peerlearning/peerlearning.html" class="dropdown-item">Introduction</a></li>
          <li><a href="/1920-s2/contents/peerlearning/textbook.html" class="dropdown-item">Textbook Contributions</a></li>
          <li><a href="/1920-s2/contents/peerlearning/peerlearningtask.html" class="dropdown-item">Peer Learning Tasks</a></li>
          <li><a href="/1920-s2/contents/peerlearning/piazza.html" class="dropdown-item">Piazza Participation</a></li>
        </dropdown>
        <div class="nav-link temp-dropdown-placeholder">Guides</div>
        <dropdown class="nav-link temp-dropdown"><template slot="_header">Guides</template>
          <li><a href="/1920-s2/contents/guides/settingUpLabEnv.html" class="dropdown-item">Setting Up Lab Environment</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpJava.html" class="dropdown-item">Setting Up Java</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpVim.html" class="dropdown-item">Setting Up Vim</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpMacVim.html" class="dropdown-item">Setting Up MacVim</a></li>
          <li><a href="/1920-s2/contents/guides/sunfireLabs.html" class="dropdown-item">Setting Up Sunfire and PE Nodes</a></li>
          <li><a href="/1920-s2/contents/guides/settingUpCheckstyle.html" class="dropdown-item">Setting Up Checkstyle</a></li>
        </dropdown>
        <li><a slot="brand" href="/1920-s2/contents/textbook/textbook.html" class="nav-link">Textbook</a></li>
        <div class="nav-link temp-dropdown-placeholder">Links</div>
        <dropdown class="nav-link temp-dropdown"><template slot="_header">Links</template>
          <li><a href="https://www.comp.nus.edu.sg/~cs2030/style/" class="dropdown-item" target="_blank">CS2030 Java Style Guide</a></li>
          <li><a href="https://www.comp.nus.edu.sg/~cs2030/javadoc/" class="dropdown-item" target="_blank">CS2030 Javadoc Specification</a></li>
          <li><a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk11-downloads-5066655.html" class="dropdown-item" target="_blank">JDK 11 Download Link</a></li>
          <li><a href="https://codecrunch.comp.nus.edu.sg/" class="dropdown-item" target="_blank">Codecrunch</a></li>
          <li><a href="https://github.com/nus-cs2030/1920-s2" class="dropdown-item" target="_blank">Github Repo</a></li>
          <li><a href="https://piazza.com/class/k54zo22zq1t2zc" class="dropdown-item" target="_blank">Piazza Forum</a></li>
        </dropdown>
        <li slot="right">
          <form class="navbar-form">
            <searchbar :data="searchData" placeholder="Search" :on-hit="searchCallback" menu-align-right></searchbar>
          </form>
        </li>
      </navbar>
    </header>
    <div id="flex-body">

      <div id="content-wrapper">
        <br>
        <h1 id="do-you-want-to-build-a-monad-part-two">Do you want to build a monad? (Part Two)<a class="fa fa-anchor" href="#do-you-want-to-build-a-monad-part-two" onclick="event.stopPropagation()"></a></h1>
        <hr>

        <p><a href="https://github.com/nus-cs2030/1920-s2/edit/master/contents/textbook/lecture10/monadsIntro/makingTheMonad.md">Edit the material here! <span aria-hidden="true" class="fas fa-pen"></span></a></p>

        <p>This post was adapted from <a href="https://nus-cs2030.github.io/1718-s2/monad/index.html">Prof Ooi's CS2030 Website</a></p>
        <p>This post was inspired by <a href="https://blog.jcoglan.com/2011/03/05/translation-from-haskell-to-javascript-of-selected-portions-of-the-best-introduction-to-monads-ive-ever-read/">The Best Introduction to Monad</a>, but is adapted to the Object-Oritented way of programming with Java.</p>
        <p>If you have not read the first part, <a href="/1920-s2/contents/textbook/lecture10/monadsIntro/extraMonads.html">click here!</a></p>
        <h2 id="making-it-a-monad">Making it a Monad<a class="fa fa-anchor" href="#making-it-a-monad" onclick="event.stopPropagation()"></a></h2>
        <p>Let's refer back to our code from part one.</p>
        <pre><code class="hljs java"><span>  Double x;<br></span><span>  String log;<br></span><span><br></span><span>  DoubleString(<span class="hljs-keyword">double</span> x, String log) {<br></span><span>    <span class="hljs-keyword">this</span>.x = x;<br></span><span>    <span class="hljs-keyword">this</span>.log = log;<br></span><span>  }<br></span><span><br></span><span>  <span class="hljs-function">DoubleString <span class="hljs-title">sinAndLog</span><span class="hljs-params">()</span> </span>{<br></span><span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DoubleString(sin(<span class="hljs-keyword">this</span>.x), log + <span class="hljs-string">"called sin"</span>);<br></span><span>  }<br></span><span><br></span><span>  <span class="hljs-function">DoubleString <span class="hljs-title">cubeAndLog</span><span class="hljs-params">()</span> </span>{<br></span><span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DoubleString(cube(<span class="hljs-keyword">this</span>.x), log + <span class="hljs-string">"called cube"</span>);<br></span><span>  }<br></span><span>}<br></span></code></pre>
        <p>Now, here is where I jump to creating a monad. I do not want to convert all my methods that takes in <code>double</code> and returns <code>DoubleString</code> into something that takes in <code>DoubleString</code> and returns <code>DoubleString</code>. Yet, I want to be able to compose them and chain them together. So I write a general method that allows that, and that is our <code>flatMap</code> method:</p>
        <pre><code class="hljs"><span>DoubleString flatMap(Function&lt;Double, DoubleString&gt; mapper) {<br></span><span>    DoubleString ds = mapper.apply(x);<br></span><span>    return new DoubleString(ds.x, this.log + &quot;\n&quot; + ds.log);<br></span><span>}<br></span></code></pre>
        <p>We can now use <code>flatMap</code> to chain different operations together.</p>
        <pre><code class="hljs"><span>DoubleString ds = new DoubleString(5.0, &quot;&quot;)<br></span><span>    .flatMap(x -&gt; sinAndLog(x))<br></span><span>    .flatMap(x -&gt; cubeAndLog(x));<br></span></code></pre>
        <p>Now <code>DoubleString</code> is a <strong>monad</strong>!</p>
        <p>Going back to our &quot;wrap a value in a box with context&quot; explanation. If we have two such wrappers, how do we wrap twice?</p>
        <p>We have to</p>
        <pre><code>(i) wrap it one time, 

(ii) unwrap to get the new value and new context, and wrap it again.
</code></pre>
        <p>The two lines in <code>flatMap</code> corresponds to (i) and (ii) respectively.</p>
        <p>Line <code>ds = mapper.apply(x);</code> wraps it once; The next line unwraps the value and the context (<code>ds.x</code> and <code>dx.log</code>) and wraps it again ( <code>new DoubleString(..)</code> ) with the next context (<code>this.log + &quot;\n&quot; + ds.log</code>).</p>
        <p>Here is our monad:</p>
        <pre><code class="hljs"><span>class DoubleString {<br></span><span>  Double x;<br></span><span>  String log;<br></span><span><br></span><span>  DoubleString(double x, String log) {<br></span><span>    this.x = x;<br></span><span>    this.log = log;<br></span><span>  }<br></span><span><br></span><span>  DoubleString flatMap(Function&lt;Double, DoubleString&gt; mapper) {<br></span><span>    DoubleString ds = mapper.apply(x);<br></span><span>    return new DoubleString(ds.x, this.log + &quot;\n&quot; + ds.log);<br></span><span>  }<br></span><span><br></span><span>  public String toString() {<br></span><span>    return x + &quot;\n&quot; + log;<br></span><span>  }<br></span><span>}<br></span></code></pre>
        <h2 id="fulfilling-the-monad-laws">Fulfilling the Monad laws<a class="fa fa-anchor" href="#fulfilling-the-monad-laws" onclick="event.stopPropagation()"></a></h2>
        <p>In order for a class to act as a Monad, it is not sufficient for it to merely represent a Monad syntatically by having a <code>flatMap</code> method or an <code>of()</code> method. It also has to behave the same semantically, by fulfilling certain laws, mainly the left identity law, the right identity law and the associative law. Let's dive deeper and check whether our DoubleString class fulfills these law.</p>
        <p>A Monad should have an unit operator, or more commonly seen as the <code>of()</code> method, which constructs a pure Monad with no context. Although our DoubleString class has no explicit <code>of()</code> method, the constructor can be seen as creating a pure DoubleString object with no context. We can achieve this by passing in <strong>an empty String</strong> into the constructor. So let's use the constructor with empty String as an unit operator that creates a pure DoubleString.</p>
        <p>Note that in the following laws, there is a difference between <strong>M</strong>onad (with capital M), and monad. A Monad is one that has a pure context, i.e. new DoubleString(x, &quot;&quot;), where log is an empty String, while a monad is one that already <strong>has some context</strong>, i.e. DoubleString(x, &quot;divide&quot;).</p>
        <p>Given functions <code>f denoted x → f(x)</code>, <code>g denoted x → g(x)</code>:</p>
        <p>The <strong>left identity law</strong> states that <code>Monad.of(x).flatMap(f) ≡ f.apply(x)</code>.</p>
        <p>In this case, <code>new DoubleString(x, &quot;&quot;).flatMap(x -&gt; new DoubleString(x, &quot;&quot;))</code> is just <code>f.apply(new DoubleString(x, &quot;&quot;).x)</code>, which returns us <code>DoubleString(x, &quot;&quot;)</code>.
          <code>DoubleString(x, &quot;&quot;)</code> is equivalent to our pure Monad, <code>new DoubleString(x, &quot;&quot;)</code>.
          Hence, the left identity law holds.</p>
        <p>The <strong>right identity law</strong> states that <code>monad.flatMap(x -&gt; Monad.of(x)) ≡ monad</code>.</p>
        <p>Suppose we have <code>DoubleString object a</code>, which has some context in its String log, e.g. &quot;divide&quot;. a is not a pure Monad as it already has some context.
          <code>a.flatMap(x -&gt; new DoubleString(x, &quot;&quot;)) = new DoubleString(a.x, a.log + &quot;&quot;) = a</code>.
          Hence, the right identity law holds.</p>
        <p>The <strong>associative law</strong> states that <code>monad.flatMap(f).flatMap(g) ≡ monad.flatMap(x -&gt; f.apply(x).flatMap(g))</code>.</p>
        <p>Suppose we have the same DoubleString object a,
          <code>a.flatMap(x -&gt; new DoubleString(x1, &quot;action1&quot;)).flatMap(x -&gt; new DoubleString(x2, &quot;action2&quot;))</code>
          = <code>new DoubleString(x2, a.log + &quot;action1&quot; + &quot;action2&quot;)</code>,</p>
        <p>which is equals to</p>
        <p><code>a.flatMap(x -&gt; f.apply(a.x).flatMap(x -&gt; new DoubleString(x2, &quot;action2&quot;)))</code>
          = <code>a.flatMap(x -&gt; new DoubleString(x2, &quot;action1&quot; + &quot;action2&quot;)</code>
          = <code>new DoubleString(x2, a.log + &quot;action1&quot; + &quot;action2&quot;)</code>.</p>
        <p>Hence, the associative law holds.</p>
        <h2 id="making-a-generic-monad-that-logs">Making a Generic Monad that Logs<a class="fa fa-anchor" href="#making-a-generic-monad-that-logs" onclick="event.stopPropagation()"></a></h2>
        <p>We can make <code>DoubleString</code> a <strong>generic class</strong> that logs what happen to a variable.</p>
        <pre><code class="hljs"><span>  T x;<br></span><span>  String log;<br></span><span><br></span><span>  Logger(T x, String log) {<br></span><span>    this.x = x;<br></span><span>    this.log = log;<br></span><span>  }<br></span><span><br></span><span>  &lt;R&gt; Logger&lt;R&gt; flatMap(Function&lt;? super T, ? extends Logger&lt;? extends R&gt;&gt; mapper) {<br></span><span>    Logger&lt;R&gt; ds = mapper.apply(x);<br></span><span>    return new Logger&lt;&gt;(ds.x, this.log + &quot;\n&quot; + ds.log);<br></span><span>  }<br></span><span><br></span><span>  public String toString() {<br></span><span>    return x + &quot;\n&quot; + log;<br></span><span>  }<br></span><span>}<br></span></code></pre>
        <h2 id="functor">Functor<a class="fa fa-anchor" href="#functor" onclick="event.stopPropagation()"></a></h2>
        <p>Can we do this with a functor? Note that a functor has a <code>map</code> method with type <code>Function&lt;T,R&gt;</code>. A <code>map</code> method for <code>DoubleString</code> would looks like <code>Function&lt;Double,Double&gt;</code>. So it cannot do what the monad does. A functor can only change the value inside the box, but it cannot rewrap it with an updated context.</p>
        <h2 id="wait-what-is-a-monad-again">Wait, What is a Monad Again?<a class="fa fa-anchor" href="#wait-what-is-a-monad-again" onclick="event.stopPropagation()"></a></h2>
        <p>I hope the example above helps explain what is a monad.</p>
        <p>It is a <strong>value wrapped in a box with context</strong>, and it allows us to compose wrappers (wrap multuple times), operate on its value and update the context if needed.</p>
      </div>


      <nav id="page-nav" class="navbar navbar-light bg-transparent">
        <div class="border-left-grey nav-inner position-sticky slim-scroll">

          <nav class="nav nav-pills flex-column my-0 small no-flex-wrap">
            <a class="nav-link py-1" href="#do-you-want-to-build-a-monad-part-two">Do you want to build a monad? (Part Two)&#x200E;</a>
            <nav class="nav nav-pills flex-column my-0 nested no-flex-wrap">
              <a class="nav-link py-1" href="#making-it-a-monad">Making it a Monad&#x200E;</a>
              <a class="nav-link py-1" href="#fulfilling-the-monad-laws">Fulfilling the Monad laws&#x200E;</a>
              <a class="nav-link py-1" href="#making-a-generic-monad-that-logs">Making a Generic Monad that Logs&#x200E;</a>
              <a class="nav-link py-1" href="#functor">Functor&#x200E;</a>
              <a class="nav-link py-1" href="#wait-what-is-a-monad-again">Wait, What is a Monad Again?&#x200E;</a>
            </nav>

          </nav>
        </div>
      </nav>
    </div>
    <footer>

      <div class="text-center">
        <small>Generated by <a href="https://markbind.org/">MarkBind 2.14.1</a> on Mon, May 11, 2020, 1:16:05 AM UTC</small></div>
    </footer>
  </div>
</body>
<script src="../../../../markbind/js/vue.min.js"></script>
<script src="../../../../markbind/js/vue-strap.min.js"></script>
<script src="../../../../markbind/js/bootstrap-utility.min.js"></script>
<script src="../../../../markbind/js/polyfill.min.js"></script>
<script src="../../../../markbind/js/bootstrap-vue.min.js"></script>
<script>
  const baseUrl = '/1920-s2'
  const enableSearch = true
</script>
<script src="../../../../markbind/js/setup.js"></script>
<script src="../../../../markbind/layouts/default/scripts.js"></script>

</html>